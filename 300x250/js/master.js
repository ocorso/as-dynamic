/**
 * Dynamic Content Enable code for Profile: 1085016
 *
 * The following code initializes the following dynamic variables for
 * development testing and live serving of Fields associated to the above profile

 *   DynamicContent Start: HTML5 invocation code.
*/

// Dynamic Content variables and sample values
    Enabler.setProfileId(1085016);
    var devDynamicContent = {};

    devDynamicContent.aslocalfeed_Allstate_Local_Feed= [{}];
    devDynamicContent.aslocalfeed_Allstate_Local_Feed[0]._id = 0;
    devDynamicContent.aslocalfeed_Allstate_Local_Feed[0].Variation = "DF";
    devDynamicContent.aslocalfeed_Allstate_Local_Feed[0].Is_Default = true;
    devDynamicContent.aslocalfeed_Allstate_Local_Feed[0].Exit_URL = {};
    devDynamicContent.aslocalfeed_Allstate_Local_Feed[0].Exit_URL.Url = "https://www.onallstate.com/LP/2016/brand-campaign/localagents/";
    devDynamicContent.aslocalfeed_Allstate_Local_Feed[0].elemType = "LI ID";
    devDynamicContent.aslocalfeed_Allstate_Local_Feed[0].Savings_Percentage = "N\/A";
    devDynamicContent.aslocalfeed_Allstate_Local_Feed[0].Market_Name = "";
    devDynamicContent.aslocalfeed_Allstate_Local_Feed[0].Legal_Copy = "Savings &amp; coverage subject to terms, conditions and availability. Savings Vary. Allstate Indemnity Co. &amp; Allstate Fire and Casualty Insurance Co. &amp; their Affiliates: Northbrook, IL. &copy;2015 Allstate Insurance Co.";
    devDynamicContent.aslocalfeed_Allstate_Local_Feed[0].Background_Color = "#FF9E16";
    devDynamicContent.aslocalfeed_Allstate_Local_Feed[0].Image1_160x600 = {};
    devDynamicContent.aslocalfeed_Allstate_Local_Feed[0].Image1_160x600.Type = "file";
    devDynamicContent.aslocalfeed_Allstate_Local_Feed[0].Image1_160x600.Url = "https://s0.2mdn.net/ads/richmedia/studio/44448670/37231879_20160721142255788_DF_image1_300x250.jpg";
    devDynamicContent.aslocalfeed_Allstate_Local_Feed[0].Image2_160x600 = {};
    devDynamicContent.aslocalfeed_Allstate_Local_Feed[0].Image2_160x600.Type = "file";
    devDynamicContent.aslocalfeed_Allstate_Local_Feed[0].Image2_160x600.Url = "https://s0.2mdn.net/ads/richmedia/studio/44448670/37231879_20160721142255788_DF_image1_300x250.jpg";
    devDynamicContent.aslocalfeed_Allstate_Local_Feed[0].Image3_160x600 = {};
    devDynamicContent.aslocalfeed_Allstate_Local_Feed[0].Image3_160x600.Type = "file";
    devDynamicContent.aslocalfeed_Allstate_Local_Feed[0].Image3_160x600.Url = "https://s0.2mdn.net/ads/richmedia/studio/44448670/37231879_20160721142255788_DF_image1_300x250.jpg";
    devDynamicContent.aslocalfeed_Allstate_Local_Feed[0].Image1_300x250 = {};
    devDynamicContent.aslocalfeed_Allstate_Local_Feed[0].Image1_300x250.Type = "file";
    devDynamicContent.aslocalfeed_Allstate_Local_Feed[0].Image1_300x250.Url = "https://s0.2mdn.net/ads/richmedia/studio/44448670/37231879_20160721142255788_DF_image1_300x250.jpg";
    devDynamicContent.aslocalfeed_Allstate_Local_Feed[0].Image2_300x250 = {};
    devDynamicContent.aslocalfeed_Allstate_Local_Feed[0].Image2_300x250.Type = "file";
    devDynamicContent.aslocalfeed_Allstate_Local_Feed[0].Image2_300x250.Url = "https://s0.2mdn.net/ads/richmedia/studio/44448670/37231879_20160721142255788_DF_image1_300x250.jpg";
    devDynamicContent.aslocalfeed_Allstate_Local_Feed[0].Image3_300x250 = {};
    devDynamicContent.aslocalfeed_Allstate_Local_Feed[0].Image3_300x250.Type = "file";
    devDynamicContent.aslocalfeed_Allstate_Local_Feed[0].Image3_300x250.Url = "https://s0.2mdn.net/ads/richmedia/studio/44448670/37231879_20160721142255788_DF_image1_300x250.jpg";
    devDynamicContent.aslocalfeed_Allstate_Local_Feed[0].Image1_728x90 = {};
    devDynamicContent.aslocalfeed_Allstate_Local_Feed[0].Image1_728x90.Type = "file";
    devDynamicContent.aslocalfeed_Allstate_Local_Feed[0].Image1_728x90.Url = "https://s0.2mdn.net/ads/richmedia/studio/44448670/37231879_20160721142255788_DF_image1_300x250.jpg";
    devDynamicContent.aslocalfeed_Allstate_Local_Feed[0].Image2_728x90 = {};
    devDynamicContent.aslocalfeed_Allstate_Local_Feed[0].Image2_728x90.Type = "file";
    devDynamicContent.aslocalfeed_Allstate_Local_Feed[0].Image2_728x90.Url = "https://s0.2mdn.net/ads/richmedia/studio/44448670/37231879_20160721142255788_DF_image1_300x250.jpg";
    devDynamicContent.aslocalfeed_Allstate_Local_Feed[0].Image3_728x90 = {};
    devDynamicContent.aslocalfeed_Allstate_Local_Feed[0].Image3_728x90.Type = "file";
    devDynamicContent.aslocalfeed_Allstate_Local_Feed[0].Image3_728x90.Url = "https://s0.2mdn.net/ads/richmedia/studio/44448670/37231879_20160721142255788_DF_image1_300x250.jpg";
    devDynamicContent.aslocalfeed_Allstate_Local_Feed[0].Image1_300x600 = {};
    devDynamicContent.aslocalfeed_Allstate_Local_Feed[0].Image1_300x600.Type = "file";
    devDynamicContent.aslocalfeed_Allstate_Local_Feed[0].Image1_300x600.Url = "https://s0.2mdn.net/ads/richmedia/studio/44448670/37231879_20160721142255788_DF_image1_300x250.jpg";
    devDynamicContent.aslocalfeed_Allstate_Local_Feed[0].Image2_300x600 = {};
    devDynamicContent.aslocalfeed_Allstate_Local_Feed[0].Image2_300x600.Type = "file";
    devDynamicContent.aslocalfeed_Allstate_Local_Feed[0].Image2_300x600.Url = "https://s0.2mdn.net/ads/richmedia/studio/44448670/37231879_20160721142255788_DF_image1_300x250.jpg";
    devDynamicContent.aslocalfeed_Allstate_Local_Feed[0].Image3_300x600 = {};
    devDynamicContent.aslocalfeed_Allstate_Local_Feed[0].Image3_300x600.Type = "file";
    devDynamicContent.aslocalfeed_Allstate_Local_Feed[0].Image3_300x600.Url = "https://s0.2mdn.net/ads/richmedia/studio/44448670/37231879_20160721142255788_DF_image1_300x250.jpg";
    Enabler.setDevDynamicContent(devDynamicContent);

/**
 * You may access the variables in the following manner
 * AFTER the Studio Enabler is initialized.
 * var Is_Default = dynamicContent.aslocalfeed_Allstate_Local_Feed[0].Is_Default;
 * Note: be sure to use "dynamicContent", not "devDynamicContent"
 * Note: be sure to use ExitOverride to create your exit URL dynamically; follow the instructions on our Help center: https://support.google.com/richmedia/answer/2664807
*/

var asDynamic = {};


if (!Enabler.isInitialized()) {
  Enabler.addEventListener(
    studio.events.StudioEvent.INIT,
    enablerInitialized);
} else {
  enablerInitialized();
}

function enablerInitialized() {
  // Enabler initialized.
  // In App ads are rendered offscreen so animation should wait for
  // the visible event. These are simulated with delays in the local
  // environment.
  if (!Enabler.isVisible()) {
    Enabler.addEventListener(
      studio.events.StudioEvent.VISIBLE,
      asDynamic.init);
  } else {
    asDynamic.init();
  }

    /*******************************************************************************
         Start of Adometry Tag for DoubleClick Dynamic Creatives: DO NOT REMOVE.
         Append this entire block to enablerInitHandler(), ONLY AFTER executing
         Enabler.setDevDynamicContent(devDynamicContent).  Be sure to set 'nid'
         below according to your Adometry account ID.
         
         nid = Adometry account id, pid = DCM placement id, cid = dynamic element ID 
    ********************************************************************************/

    var nid=3700;
    var pid=(function(){p=Enabler.getDartPageId();if(!isNaN(p))return p;else return 0})();
    var cid=(function(){s='';d=dynamicContent;for(x in d){if(x!='_profileid')s+=(d[x][0].elemType+d[x][0].ID);}for(var h=0,i=0;i<s.length;i++)h=h*31+s.charCodeAt(i);return h&0x7FFFFFFF})();
    var str='https://js.dmtry.com/antenna2.js?0_'+nid+'_'+pid+'_'+cid;
    console.log(str);
    var script=document.createElement('script');
    script.src = str;
    document.body.appendChild(script);

   /*******************************************************************************
         End Adometry Tag for DoubleClick Dynamic Creatives: DO NOT REMOVE. 
   ********************************************************************************/
} //end function enabler init();

/**
 * This function is called when the Enabler is initialized.
 * Uses dynamic content to determine which variation to display
 *
 */
asDynamic.init = function() {
  console.info('asDynamic.init(); Variation Code: '+ dynamicContent.aslocalfeed_Allstate_Local_Feed[0].Variation);

  //oc: Google Fonts Fix.
  TweenLite.set("#atAd300x250", { visibility: "visible"});

  //oc: Step 1: map dynamic values to elements in markup
  asDynamic.parseDynamicContent();

  //oc: Step 2: config split text
  asDynamic.splitText();

  //oc: Step 3: Init TimelineMax
  tl = new TimelineMax();

  //oc: Step 4: handle variations independently.
  //switch (dynamicContent.aslocalfeed_Allstate_Local_Feed[0].Variation) { //oc: hardcode to variation for dev
  switch ('AF') { //oc: hardcode to variation for dev
    case 'AF': asDynamic.accidentForgivenessInit(); break;
    case 'BSAHLP': asDynamic.bundleSaveInit('ahlp'); break;
    case 'BSAHL': asDynamic.bundleSaveInit('ahl'); break;
    case 'BSHLI': asDynamic.bundleSaveInit('hli'); break;
    case 'BSALP': asDynamic.bundleSaveInit('alp'); break;
    case 'BSAL': asDynamic.bundleSaveInit('al'); break;
    case 'BSAHMP': asDynamic.bundleSaveInit('ahmp'); break;
    case 'BSAHM': asDynamic.bundleSaveInit('ahm'); break;
    case 'BSACP': asDynamic.bundleSaveInit('acp'); break;
    case 'BSAC': asDynamic.bundleSaveInit('ac'); break;
    case 'CFD': asDynamic.claimFreeDiscountInit(); break;
    case 'CFDM': asDynamic.claimFreeDiscountInit('mob'); break;
    case 'CFR': asDynamic.claimFreeRewardsInit(); break;
    case 'CRG': asDynamic.claimRateGuardInit(); break;
    case 'CRGM': asDynamic.claimRateGuardInit('mob'); break;
    case 'CSG': asDynamic.claimSatGuardInit(); break;
    case 'CSGM': asDynamic.claimSatGuardInit('mob'); break;
    case 'DW': asDynamic.driveWiseInit('opt1'); break;
    case 'DW2P': asDynamic.driveWiseInit('opt2p'); break;
    case 'NR': asDynamic.newRoofInit(); break;
    case 'TA1': asDynamic.trustedAdvisorInit('opt1'); break;
    case 'TAM1': asDynamic.trustedAdvisorInit('mobopt1'); break;
    case 'TAM2': asDynamic.trustedAdvisorInit('mobopt2'); break;
    case 'WD': asDynamic.welcomeDiscountInit(); break;
    case 'DF': asDynamic.defaultInit(); break;
    default:
      console.log('Run default ad');
      asDynamic.defaultInit();
  } //end switch
}; //end asDynamic.init

/**
  * This function takes the dynamic data served to the create 
  * and maps it to the corresponding HTMLElement
  * 
  */
asDynamic.parseDynamicContent = function(){
  console.info('asDynamic.parseDynamicContent()');

  //oc: Set bg color
  var bg = document.getElementById('bkgReveal');
  bg.style.backgroundColor = dynamicContent.aslocalfeed_Allstate_Local_Feed[0].Background_Color;

  //oc: Map Images
  var img1 = document.getElementById('img1');
  img1.src = dynamicContent.aslocalfeed_Allstate_Local_Feed[0].Image1_300x250.Url;
  var img2 = document.getElementById('img2');
  img2.src = dynamicContent.aslocalfeed_Allstate_Local_Feed[0].Image2_300x250.Url;
  var img3 = document.getElementById('img3');
  img3.src = dynamicContent.aslocalfeed_Allstate_Local_Feed[0].Image3_300x250.Url;

  //oc: TODO Set market name

  //oc: TODO Set legal text

};//end asDynamic.parseDynamicContent() function

/**
  * This function splits the text so each word can by styled/animated
  */
asDynamic.splitText = function(){

  getIN = new SplitText('#getIN', {
    type: "words",
    wordsClass: "word++"
  });
  frame3 = new SplitText('.frame3', {
    type: "words",
    wordsClass: "word++"
  });
  frame4 = new SplitText('.frame4', {
    type: "words",
    wordsClass: "word++"
  });

  $("#getIN .word2").attr('class', 'whiteIN');
  // $("#frame2 .word5").attr('class', 'colorIN');

};

/**
 * This function takes the timeline as a parameter and 
 * puts the Hands animation on it.
 */
asDynamic.addHandsFrameToTimeline = function(){

 tl.to(".in1", 0.2, {
    autoAlpha: 1
  });
  tl.to(".in2", 0.2, {
    autoAlpha: 1
  });
  tl.to(".in3", 0.2, {
    autoAlpha: 1
  });
  tl.to(".in4", 0.2, {
    autoAlpha: 1
  });
  tl.to(".in5", 0.2, {
    autoAlpha: 1
  });

  tl.from("#hands", .6, {
    scaleX: 0,
    scaleY: 0,
    ease: Back.easeInOut,
    easeParams: [2],
    transformOrigin: "40% 40%",
    opacity: 0
  });

  tl.to(".message", .5, {
    autoAlpha: 0,
    delay: 1
  });
};//end function

asDynamic.addGetINFrameToTimeline = function(){
 
  //oc: GetIn Frame BEGIN
  tl.staggerFrom(getIN.words, 0.2, {
    left: -300
  }, 0.07)

  tl.to("#getIN", 0.3, {
    autoAlpha: 0,
    delay: 2
  });
  //oc: GetIn Frame 2 END
};

/**
  * This function scripts the Image wipe/reveal transitions
  */
asDynamic.addImageFramesToTimeline = function($variation, numImages){
  
  //oc: 
  tl.to("#bkgReveal", 0.7, {
    left: 400,
    top: -200,
    ease: Sine.easeOut
  });

  tl.staggerFrom(frame3.words, 0.2, {
    left: -300
  }, 0.07)

  tl.to(".frame3", 0.3, {
    autoAlpha: 0,
    delay: 2
  });

  tl.to("#bgImg1", 0.5, {
    left: 300,
    ease: Sine.easeOut
  });

  tl.to("#bgImg2", 0.5, {
    left: 0,
    ease: Sine.easeOut,
    delay: -0.5
  });

  tl.staggerFrom(frame4.words, 0.2, {
    left: -300
  }, 0.07)

  tl.to(".frame4", 0.3, {
    autoAlpha: 0,
    delay: 2
  });

  tl.to("#bkgReveal", 0.7, {
    left: -100,
    top: -200,
    ease: Sine.easeOut
  });
};//end asDynamic.addImageFramesToTimeline function

/**
  * This function adds the landing frame's animation sequence to the timeline.
  */
asDynamic.addLandingToTimeline = function($variation){
  tl.to(".fade", 0.3, {
    autoAlpha: 1
  });

  tl.to(".fade1", 0.3, {
    autoAlpha: 1
  });

  tl.to("#landing", 1, {
    autoAlpha: 1
  });

  tl.to("#btn_cta", 0.3, {
    right: -9,
    autoAlpha: 1,
    delay: -0.5
  });

  tl.to("#btn_cta", 0.3, {
    right: -20,
    repeat:2,
    yoyo: true,
    ease: Linear.easeNone
  });

};

/**
  * This function handles the Accident Forgiveness variations
  * @param - ad variation option
  * Global syles:
      - Background: #8b86ca
      - CTA:    “GET IN”
  * Keyframes :
      1 : Logo Lockup
      2 :
        Top-aligned paragraph -
        Font size: 36 px
        Copy: “GET IN ON THIS, [MARKET NAME]”
      3 : Photo w/ ⅓ - top White Copy
        Copy : “FORGIVENESS”
      4 : Photo w/ ⅓ - bottom white copy
        Copy : “EVEN IF IT’S YOUR FAULT”
      5 : End Frame
        OPTION ONE:
          Top-aligned large copy - 36 px
          Larger copy: “ACCIDENT FORGIVENESS”
          Smaller copy - 18px
            “Connect with a [Market Name] Allstate Agent”
        OPTION TWO:
          Top-aligned large copy - 36 px
          Larger opy: “ACCIDENT FORGIVENESS”
          Smaller copy - 18px

*/
asDynamic.accidentForgivenessInit = function() {
  console.info('accidentForgivenessInit');

  $('#af, #getIN').css('display', 'block');
  asDynamic.addHandsFrameToTimeline(tl);
  asDynamic.addGetINFrameToTimeline(tl);
  asDynamic.addImageFramesToTimeline(tl);
  asDynamic.addLandingToTimeline(tl);
 

} //end accidentForgivenessInit() function


asDynamic.bundleSaveInit = function($option) {
  console.info('asDynamic.bundleSaveInit()');

  //show bundleSave elements
  $('#bsahl, #getIN').css('display', 'block');

  console.debug('is this working?');
}; //end function bundleSaveInit

/**
  * This function scripts the New Roof variation
  */
asDynamic.newRoofInit = function(){
  console.info('asDynamic.newRoofInit()');

  //oc: Smooth house animation in new roof
  CSSPlugin.useSVGTransformAttr = true;
}//end function newRoofInint

// oc: CTA Mouseover handlers
var div1 = $("div#btn_cta"),
  tn1 = TweenMax.to(div1, .3, {
    right: 0,
    repeat: 10,
    yoyo: true,
    ease: Linear.easeNone,
    paused: true
  });

div1.mouseenter(function() {
  tn1.play();
});

div1.mouseleave(function() {
  var currentTime = tn1.time();
  tn1.reverse(currentTime);
});

/**
  * This function handles the Background and CTA clicks
  * And overrides the system's exit to navigate to a dynamic exit url
  */
function onExitClick(event){
  console.info('onExitClick()');
};

